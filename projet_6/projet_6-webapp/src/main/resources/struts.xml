<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

	<!-- ============================================================== Package de base ============================================================== -->
    <package name="base" abstract="true" extends="struts-default">
       <interceptors>
        	<interceptor name="authentification" class="authentificationInterceptor" />
        	<interceptor name="encoding" class="encodingInterceptor" />
        	
        	<interceptor-stack name="baseStack">
                <interceptor-ref name="encoding" />
                <interceptor-ref name="defaultStack" />
            </interceptor-stack>
        	
            <interceptor-stack name="authenticatedStack">
                <interceptor-ref name="authentification" />
                <interceptor-ref name="baseStack" />
            </interceptor-stack>
        </interceptors>
        
        <!-- Results globaux -->
        <global-results>
        	<result name="error-forbidden" type="httpheader">
                <param name="error">403</param>
            </result>
            
            <result name="error">/WEB-INF/jsp/other/error.jsp</result>      
        </global-results>
                
     </package>
     
     <!-- ============================================================== Package public ============================================================== -->
     <package name="public" extends="base">
     
        <default-interceptor-ref name="baseStack" />
     
		<!-- Action par défaut -->
    	<default-action-ref name="index" />
    	
             <!-- Action "index" -->
        <action name="index">
            <result>/WEB-INF/jsp/other/index.jsp</result>
        </action>
        
     <!-- ====================================== GestionTopoAction ===================================== -->
        
        <!-- Action permettant d'afficher la liste des topos -->
        <action name="topo_list"
        		class="gestionTopoAction"
        		method="doList">
        	<result>/WEB-INF/jsp/topo/list-topo.jsp</result>
        </action>
        
        
        <!-- Action permettant d'afficher les détails d'un topo -->
        <action name="topo_detail"
        		class="gestionTopoAction"
        		method="doDetail">
        	
        	<!-- Interceptor necessaire dans le cas ou on arrive sur cette page suite à une redirection (ex :deposer commentaire)  -->	
        	<interceptor-ref name="baseStack" />
        	<interceptor-ref name="store">
        		<param name="operationMode">RETRIEVE</param>
   		 	</interceptor-ref>
    
        	<result name="success">/WEB-INF/jsp/topo/topo.jsp</result>
        	
        </action>
        
     </package>
     
     <!-- ============================================================== Package privé ============================================================== -->
      <package name="private" extends="base">
      
      	<!-- Pile d'interceptor par defaut pour le package private (composition dans le package 'base') -->
      	<!-- Permet de restreindre les action du package au utilisateur connecté -->
      	<default-interceptor-ref name="authenticatedStack" />
     
     <!-- ====================================== GestionTopoAction ===================================== -->
     	<!-- Action permettant d'afficher la bibliotheque de l'utilisateur -->
		<action name="library"
        		class="gestionTopoAction"
        		method="doLibrary">
        		
        	<interceptor-ref name="authenticatedStack" />
    	 	<interceptor-ref name="store">
        		<param name="operationMode">RETRIEVE</param>
    		</interceptor-ref>	
        		
        	<result name="success">/WEB-INF/jsp/topo/bibliotheque.jsp</result>
        </action>
     
     	<!-- Action permettant d'ajouter un topo à la bibliotheque de l'utilisateur -->
		<action name="add_library"
        		class="gestionTopoAction"
        		method="doAddLibrary">
        		
        	<interceptor-ref name="authenticatedStack" />
    	 	<interceptor-ref name="store">
        		<param name="operationMode">STORE</param>
    		</interceptor-ref>	
        		
        	<result name ="success" type="redirectAction">library</result>
        	
        	<result name ="input" type="redirectAction">
        		<param name="actionName">topo_detail</param>
        		<param name="idTopo">${idTopo}</param>
    		</result>
        </action>
        
        
        <!-- Action permettant de supprimer un topo de la bibliotheque de l'utilisateur -->
		<action name="remove_library"
        		class="gestionTopoAction"
        		method="doRemoveLibrary">
        		
        	<interceptor-ref name="authenticatedStack" />
    	 	<interceptor-ref name="store">
        		<param name="operationMode">STORE</param>
    		</interceptor-ref>
    		
        	<result name="success" type="redirectAction">library</result>
        	<result name="input" type="redirectAction">library</result>
        </action>
        
        
        <!-- Action permettant d'ajouter un commentaire de topo -->        
        <action name="topo_comment"
        		class="gestionTopoAction"
        		method="doAddComment">
        	
        	<!-- Interceptor necessaire en cas de succes (redirection = securité) pour stocker le nouveau commentaire en session  -->
			<interceptor-ref name="authenticatedStack" />
    	 	<interceptor-ref name="store">
        		<param name="operationMode">STORE</param>
    		</interceptor-ref>
    
        	<result name= "success" type="redirectAction">
        		<param name="actionName">topo_detail</param>
        		<param name="idTopo">${idTopo}</param>
    		</result>
    		<result name= "input" type="redirectAction">
        		<param name="actionName">topo_detail</param>
        		<param name="idTopo">${idTopo}</param>
    		</result>
        </action>
        
        
     </package>
    
    
</struts>